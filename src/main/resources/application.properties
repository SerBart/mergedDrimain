# --- JWT ---
# Prefer app.jwt.secret (used by the app) and allow override from env
app.jwt.secret=${APP_JWT_SECRET:REPLACE_WITH_STRONG_SECRET_AT_LEAST_32_CHARS_LONG_1234567890}

# Optional legacy keys (keep for backward compatibility, overridable via env if needed)
jwt.secret=${JWT_SECRET_BASE64:REPLACE_WITH_BASE64_SECRET_256bit_EXAMPLE_dGhpc0lzQVNlY3JldEtleVNlZWQhITIzNDU2Nzg5MA==}
jwt.secret.plain=${JWT_SECRET_PLAIN:super_tajny_klucz_dev_32+_znakow_!!!_123456}
jwt.expiration.minutes=${JWT_EXP_MINUTES:60}

# --- DataSource Configuration ---
# Prefer DATABASE_URL if provided by the platform; otherwise fall back to embedded H2 (PostgreSQL compatibility mode)
# This prevents accidental attempts to connect to localhost on platforms like Railway and avoids 502 due to app crash on startup.
spring.datasource.url=${DATABASE_URL:jdbc:h2:mem:drimain;MODE=PostgreSQL;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE}
# Intentionally do NOT set username/password here to let Spring Boot auto-configure:
# - For H2: no credentials required
# - For Postgres: credentials can be embedded in DATABASE_URL or provided via SPRING_DATASOURCE_USERNAME/PASSWORD

# --- JPA + Hibernate ---
# Use update by default so that H2 fallback can initialize schema without Flyway.
spring.jpa.hibernate.ddl-auto=${JPA_DDL_AUTO:update}
spring.jpa.show-sql=false
spring.jpa.defer-datasource-initialization=false

# --- Flyway ---
# Disable by default to avoid Postgres-specific migrations breaking H2 fallback. Enable on platforms with Postgres via FLYWAY_ENABLED=true.
spring.flyway.enabled=${FLYWAY_ENABLED:false}
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.sql.init.mode=never

# --- H2 Console (dev only; harmless if not used) ---
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

# --- Attachment Storage Configuration ---
# Use /tmp on Railway by default (writable on ephemeral FS), override via ATTACHMENTS_BASE_PATH if needed
app.attachments.base-path=${ATTACHMENTS_BASE_PATH:/tmp/uploads/attachments}
app.attachments.max-file-size-bytes=${ATTACHMENTS_MAX_SIZE:10485760}

# --- SSE Configuration ---
app.sse.max-clients=${SSE_MAX_CLIENTS:100}
app.sse.heartbeat-interval-seconds=${SSE_HEARTBEAT_SECONDS:30}
app.sse.client-timeout-seconds=${SSE_CLIENT_TIMEOUT_SECONDS:300}

# --- CORS ---
app.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:5173}
